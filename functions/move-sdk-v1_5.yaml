openapi: 3.0.1
info:
  title: Dolphin SDK
  description: Description of the public Dolphin SDK V1.5 backend
  version: "1.5"
servers:
  - url: https://sdk.dolph.in/
    description: prod
security:
  - bearerAuth: []
tags:
  - name: SdkTimelineV1_5
    description: SdkTimelineV1.5
  - name: SdkLocationV1_5
    description: Location of sdk users
  - name: AuthAdminV1_5
    description: Api for Product Backend
  - name: AccessAdminV1_5
    description: Access managment for Move SDK
paths:
  /timeline/v1_5/{startTs}:
    get:
      tags:
        - SdkTimelineV1_5
      description: get a single timeline item
      parameters:
        - name: productId
          in: query
          required: true
          explode: true
          schema:
            type: integer
            format: int64
        - name: contractId
          in: query
          required: true
          explode: false
          schema:
            type: string
        - name: startTs
          in: path
          required: true
          explode: false
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: Request was successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiTimelineItem'
        default:
          description: An unexpected error occurred while processing the request.
    delete:
      tags:
        - SdkTimelineV1_5
      description: delete a single timeline item
      parameters:
        - name: productId
          in: query
          required: true
          explode: true
          schema:
            type: integer
            format: int64
        - name: contractId
          in: query
          required: true
          explode: false
          schema:
            type: string
        - name: startTs
          in: path
          required: true
          explode: false
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: Request was successful
        "404":
          description: Item not found
        default:
          description: An unexpected error occurred while processing the request.
  /timeline/v1_5:
    get:
      tags:
        - SdkTimelineV1_5
      description: get the latest timeline items in a given time range for a user
      parameters:
        - name: contractId
          in: query
          required: true
          explode: false
          schema:
            type: string
        - name: productId
          in: query
          required: true
          explode: true
          schema:
            type: integer
            format: int64
        - name: from
          in: query
          required: false
          explode: true
          schema:
            type: integer
            format: int64
        - name: to
          in: query
          required: false
          explode: true
          schema:
            type: integer
            format: int64
        - name: limit
          in: query
          required: false
          explode: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: Request was successful
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ApiTimelineItem'
        default:
          description: An unexpected error occurred while processing the request.
  /timeline/v1_5/batch:
    post:
      tags:
        - SdkTimelineV1_5
      description: get a batch of timeline items
      requestBody:
        description: request
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/ApiTimelineItemId'
        required: true
      responses:
        "200":
          description: Request was successful
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ApiTimelineItem'
        default:
          description: An unexpected error occurred while processing the request.
  /timeline/v1_5/{startTs}/points:
    get:
      tags:
        - SdkTimelineV1_5
      description: get GPS points for a timeline item
      parameters:
        - name: productId
          in: query
          required: true
          explode: true
          schema:
            type: integer
            format: int64
        - name: contractId
          in: query
          required: true
          explode: false
          schema:
            type: string
        - name: startTs
          in: path
          required: true
          explode: false
          schema:
            type: integer
            format: int64
        - name: withWayPointInfo
          in: query
          required: false
          explode: true
          schema:
            type: boolean
      responses:
        "200":
          description: Request was successful
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WayPoint'
        default:
          description: An unexpected error occurred while processing the request.
  /sdk-auth/v1_5/deleteuser:
    post:
      tags:
        - AuthAdminV1_5
      parameters:
        - name: Authorization
          in: header
          required: true
          explode: false
          schema:
            type: string
      requestBody:
        description: request
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApiDeleteUserRequest'
      responses:
        "200":
          description: Request was successful
        default:
          description: An unexpected error occurred while processing the request.
  /sdk-auth/v1_5/jwt/registeruser:
    post:
      tags:
        - AuthAdminV1_5
      parameters:
        - name: Authorization
          in: header
          required: true
          explode: false
          schema:
            type: string
      requestBody:
        description: request
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApiRegisterUserRequest'
        required: true
      responses:
        "200":
          description: Request was successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiRegisterUserResponse'
        default:
          description: An unexpected error occurred while processing the request.
  /timeline/v1_5/admin/label/{ts}/{label}:
    patch:
      description: "Change type of timeline element"
      tags:
        - SdkTimelineV1_5
      parameters:
        - name: ts
          description: "start timestamp of timeline item"
          in: path
          required: true
          explode: false
          schema:
            type: integer
            format: int64
        - name: label
          description: "Label of timeline item "
          in: path
          required: true
          explode: false
          schema:
            type: string
            enum:
              - UNKNOWN
              - DRIVING
              - TRAIN
              - TRAM
              - BUS
              - CAR
              - METRO
              - FAKETRIP
              - WALKING
              - IDLE
              - CYCLING
        - name: productId
          in: query
          required: true
          explode: true
          schema:
            type: integer
            format: int64
        - name: contractId
          in: query
          required: true
          explode: false
          schema:
            type: string
      responses:
        "200":
          description: Request was successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiTimelineItem'
  /access/v1_5/block:
    post:
      tags:
        - AccessAdminV1_5
      parameters:
        - name: Authorization
          in: header
          required: true
          explode: false
          schema:
            type: string
      requestBody:
        description: request
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApiBlockRequest'
        required: true
      responses:
        "200":
          description: Request was successful
        default:
          description: An unexpected error occurred while processing the request.
  /location/v1_5:
    get:
      tags:
        - SdkLocationV1_5
      parameters:
        - name: productId
          in: query
          required: true
          explode: true
          schema:
            type: integer
            format: int64
        - name: contractId
          in: query
          required: true
          explode: false
          schema:
            type: string
      responses:
        "200":
          description: Request was successful
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ApiLastLocation'
  /location/v1_5/{context}:
    get:
      tags:
        - SdkLocationV1_5
      parameters:
        - name: productId
          in: query
          required: true
          explode: true
          schema:
            type: integer
            format: int64
        - name: contractId
          in: query
          required: true
          explode: false
          schema:
            type: string
        - name: context
          in: path
          required: true
          explode: false
          schema:
            type: string
      responses:
        "200":
          description: Request was successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiLastLocation'
  /state/v1_5/history:
    get:
      operationId: getStateHistory
      tags:
        - SdkStateV1_5
      description: |
        Returns a list of state changes over the given time range.
        
        For the `STATUS` property the possible values are:
        * `ERROR`
        * `UNINITIALISED`
        * `READY`
        * `RUNNING`
      parameters:
        - name: productId
          in: query
          required: true
          schema:
            type: integer
            format: int64
        - name: contractId
          in: query
          required: true
          schema:
            type: string
        - name: properties
          required: true
          in: query
          description: A comma separated list of state properties that shall be returned. At the moment the only possible value is 'STATUS'
          schema:
            type: string
          example: STATUS
        - name: from
          description: A unix timestamp, start of query range.
          in: query
          required: false
          explode: true
          schema:
            type: integer
            format: int64
        - name: to
          description: A unix timestamp, end of query range.
          in: query
          required: false
          explode: true
          schema:
            type: integer
            format: int64
        - name: limit
          description: Maximum number of items to return, must be greater than or equal to zero.
          in: query
          required: false
          explode: true
          schema:
            type: integer
            format: int32
      responses:
        "200":
          description: Request was successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiStateHistory'
components:
  schemas:
    ApiTimelineItemType:
      type: string
      enum:
        - UNKNOWN
        - DRIVING
        - TRAIN
        - TRAM
        - BUS
        - CAR
        - METRO
        - FAKETRIP
        - WALKING
        - IDLE
        - CYCLING
        - PUBLIC_TRANSPORT
    DistractionType:
      type: string
      enum:
        - PHONE_CALL_HANDS_FREE
        - SWIPE_AND_TYPE
        - PHONE_CALL
    TransportType:
      type: string
      enum:
        - TRAIN
        - TRAM
        - BUS
        - CAR
        - METRO
        - FAKETRIP
        - UNKNOWN
        - PUBLIC_TRANSPORT
    Event:
      required:
        - lat
        - lon
        - rawAccel
        - strength
        - time
      type: object
      properties:
        time:
          type: integer
          format: int64
        type:
          $ref: '#/components/schemas/EventEventType'
        strength:
          type: integer
          format: int32
        lat:
          type: number
          format: double
        lon:
          type: number
          format: double
        rawAccel:
          type: number
          format: double
    ApiSource:
      required:
        - id
        - name
      type: object
      properties:
        id:
          type: string
        name:
          type: string
    WayPoint:
      required:
        - lat
        - lon
      type: object
      properties:
        timestamp:
          type: string
          description: a timestamp as an ISO 8601 date time
          format: date-time
        lat:
          type: number
          format: double
        lon:
          type: number
          format: double
        wayPointInfo:
          $ref: '#/components/schemas/WayPointInfo'
    ApiGpsStats:
      required:
        - averageSpeed
        - distance
        - maxSpeed
      type: object
      properties:
        distance:
          type: integer
          format: int64
        maxSpeed:
          type: integer
          format: int64
        averageSpeed:
          type: integer
          format: int64
    WayPointInfo:
      type: object
      properties:
        speed:
          type: integer
          format: int64
        speedLimit:
          type: integer
          format: int64
        wayType:
          type: string
        origLat:
          type: number
          format: double
        origLon:
          type: number
          format: double
    ApiStartLocation:
      required:
        - lat
        - lon
      type: object
      properties:
        lat:
          type: number
          format: double
        lon:
          type: number
          format: double
        name:
          type: string
          default: null
        timeZone:
          type: string
          default: null
    ApiEndLocation:
      required:
        - lat
        - lon
      type: object
      properties:
        lat:
          type: number
          format: double
        lon:
          type: number
          format: double
        name:
          type: string
          default: null
        timeZone:
          type: string
          default: null
    ApiPhoneDistractions:
      required:
        - distractions
        - secondsPerType
      type: object
      properties:
        distractions:
          type: array
          items:
            $ref: '#/components/schemas/Distraction'
        secondsPerType:
          type: object
          properties:
            PHONE_CALL:
              type: integer
              format: int32
            PHONE_CALL_HANDS_FREE:
              type: integer
              format: int32
            SWIPE_AND_TYPE:
              type: integer
              format: int32
    ApiDangerousAreas:
      type: object
      properties:
        areas:
          type: array
          items:
            $ref: '#/components/schemas/DangerousArea'
    DangerousArea:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        lat:
          type: number
          format: double
        lon:
          type: number
          format: double
        radius:
          type: number
          format: double
    ApiDrivingBehaviorEvents:
      required:
        - events
        - validTime
      type: object
      properties:
        events:
          type: array
          items:
            $ref: '#/components/schemas/Event'
        validTime:
          type: integer
          format: int32
    ApiTransport:
      required:
        - probabilities
      type: object
      properties:
        type:
          $ref: '#/components/schemas/TransportType'
        probabilities:
          type: object
          properties:
            TRAIN:
              type: number
              format: double
            TRAM:
              type: number
              format: double
            BUS:
              type: number
              format: double
            CAR:
              type: number
              format: double
            METRO:
              type: number
              format: double
            FAKETRIP:
              type: number
              format: double
    ApiFeature:
      type: object
      properties:
        startLocation:
          $ref: '#/components/schemas/ApiStartLocation'
        endLocation:
          $ref: '#/components/schemas/ApiEndLocation'
        source:
          $ref: '#/components/schemas/ApiSource'
        scores:
          type: object
          additionalProperties:
            type: integer
            format: int32
        drivingBehaviorEvents:
          $ref: '#/components/schemas/ApiDrivingBehaviorEvents'
        phoneDistractions:
          $ref: '#/components/schemas/ApiPhoneDistractions'
        gpsStats:
          $ref: '#/components/schemas/ApiGpsStats'
        transport:
          $ref: '#/components/schemas/ApiTransport'
        metas:
          type: object
          additionalProperties:
            type: string
        dangerousAreas:
          $ref: '#/components/schemas/ApiDangerousAreas'
    EventEventType:
      type: string
      enum:
        - CORNERING
        - ACCELERATION
        - BRAKING
    ApiTimelineItem:
      required:
        - contractId
        - endTs
        - features
        - productId
        - startTs
        - type
      type: object
      properties:
        productId:
          type: integer
          format: int64
        contractId:
          type: string
        startTs:
          type: string
          description: a timestamp as an ISO 8601 date time
          format: date-time
        startTimeZone:
          type: string
          description: an id from the IANA timezone database
        endTs:
          type: string
          description: a timestamp as an ISO 8601 date time
          format: date-time
        endTimeZone:
          type: string
          description: an id from the IANA timezone database
        type:
          $ref: '#/components/schemas/ApiTimelineItemType'
        features:
          $ref: '#/components/schemas/ApiFeature'
    Distraction:
      type: object
      properties:
        type:
          $ref: '#/components/schemas/DistractionType'
        start:
          type: string
          description: a timestamp as an ISO 8601 date time
          format: date-time
        end:
          type: string
          description: a timestamp as an ISO 8601 date time
          format: date-time
    ApiTimelineItemId:
      required:
        - productId
      type: object
      properties:
        productId:
          type: integer
          format: int64
        contractId:
          type: string
        startTime:
          type: string
          description: a timestamp as an ISO 8601 date time
          format: date-time
    ApiRegisterUserResponse:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
        contractId:
          type: string
        audience:
          type: string
        installationId:
          type: string
        productId:
          type: integer
          format: int64
    ApiRegisterUserRequest:
      type: object
      properties:
        installationId:
          type: string
        contractId:
          type: string
    ApiDeleteUserRequest:
      type: object
      properties:
        contractId:
          type: string
    ApiBlockRequest:
      type: object
      required:
        - contractId
        - productId
        - block
      properties:
        productId:
          type: integer
          format: int64
        contractId:
          type: string
        block:
          type: boolean
    ApiLastLocation:
      type: object
      properties:
        context:
          type: string
        lat:
          type: number
          format: double
        lon:
          type: number
          format: double
        accuracy:
          type: integer
          format: Int64
        timestamp:
          type: string
          description: a timestamp as an ISO 8601 date time
          format: date-time
    ApiStateHistory:
      type: object
      required:
        - history
      properties:
        history:
          type: array
          items:
            $ref: '#/components/schemas/ApiTimestampedState'
      example:
        history:
          - data:
              STATUS: RUNNING
            timestamp: "2022-07-20T05:38:10.586Z"
          - data:
              STATUS: READY
            timestamp: "2022-07-20T04:38:10.586Z"
          - data:
              STATUS: UNINITIALISED
            timestamp: "2022-07-20T03:38:10.586Z"
    ApiTimestampedState:
      type: object
      required:
        - timestamp
        - data
      properties:
        timestamp:
          type: string
          description: the timestamp from which the given state was active
          format: date-time
        data:
          type: object
          additionalProperties:
            type: string
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT